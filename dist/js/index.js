"use strict";angular.module("app",["ui.router","ngSanitize","ngCookies"]),angular.module("app").config(["$provide",function(t){t.decorator("$http",["$delegate","$q",function(t,e){return t.post=function(o,a,r){var n=e.defer();return t.get(o).then(function(t){n.resolve(t)}).catch(function(t){n.reject(t)}),{then:function(t){n.promise.then(t)},catch:function(t){n.promise.then(null,t)}}},t}])}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("main",{url:"/main",templateUrl:"view/main.html",controller:"mainCtrl"}).state("job",{url:"/job/:id",templateUrl:"view/job.html",controller:"jobCtrl"}).state("company",{url:"/company/:id",templateUrl:"view/company.html",controller:"companyCtrl"}).state("search",{url:"/search",templateUrl:"view/search.html",controller:"searchCtrl"}).state("mine",{url:"/mine",templateUrl:"view/mine.html",controller:"mineCtrl"}).state("login",{url:"/login",templateUrl:"view/login.html",controller:"loginCtrl"}).state("register",{url:"/register",templateUrl:"view/register.html",controller:"registerCtrl"}),e.otherwise("main")}]),angular.module("app").controller("companyCtrl",["ajax","$scope","$state",function(t,e,o){t.getData("data/company.json",{id:o.params.id}).then(function(t){e.company=t.data.data[o.params.id-1]}),e.cc={bol:!1,ts:"textStyle"}}]),angular.module("app").controller("jobCtrl",["ajax","$scope","$state",function(t,e,o){t.getData("data/position.json",{id:o.params.id}).then(function(o){return e.position=o.data.data[o.config.params.id-1],t.getData("data/company.json?",{id:e.position.companyId})}).then(function(t){e.company=t.data.data[t.config.params.id-1]}),e.jc={bol:!0,ts:""}}]),angular.module("app").controller("loginCtrl",["$scope","cache","$state",function(t,e,o){t.login=function(a){if(a.$submitted=!1,a.$valid&&a.$dirty){var r=e.get("psw");t.user.password!=r?t.isPswTrue=!0:(t.isPswTrue=!1,e.put("name",t.user.password),o.go("main"))}else a.$submitted=!0},t.inputType="password",t.openEye=function(){"password"==t.inputType?(t.inputType="text",t.isEyeon=!0):(t.inputType="password",t.isEyeon=!1)}}]),angular.module("app").controller("mainCtrl",["$scope","$timeout",function(t,e,o){e.isShow=!1}]),angular.module("app").controller("mineCtrl",[function(){}]),angular.module("app").controller("registerCtrl",["$scope","cache","$http","$state",function(t,e,o,a){t.yzmCode="a 4 4 c",t.createYZM=function(){for(var o=[],a=0;a<10;a++)o.push(+String.fromCharCode(48+a));for(var r=[],a=0;a<26;a++)r.push(String.fromCharCode(65+a)),r.push(String.fromCharCode(97+a));for(var n=o.concat(r),i=[],a=0;a<4;a++)i.push(n[Math.floor(62*Math.random())]);t.yzmCode=i.join(" "),e.remove("yzm"),e.put("yzm",t.yzmCode)},t.createYZM(),t.changeYzm=function(){t.createYZM()},t.signup=function(r){t.rForm.$submitted=!1,t.rForm.$valid&&t.rForm.$dirty?o.post("data/register.json",t.user).then(function(o){var r=e.get("yzm");t.user.vcode.toLowerCase()!=r.replace(/\s+/g,"").toLowerCase()?t.isYzmTrue=!0:(t.isYzmTrue=!1,a.go("login"),e.remove("psw"),e.put("psw",t.user.psw))}):t.rForm.$submitted=!0}}]),angular.module("app").controller("searchContentCtrl",["ajax","$scope",function(t,e){}]),angular.module("app").controller("searchCtrl",["ajax","$scope",function(t,e){t.getData("data/city.json").then(function(t){e.citylist=t.data.data})}]),angular.module("app").directive("appCompanyCategory",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/companyCategory.html",scope:{com:"="},link:function(t){t.showTypeList=function(e){0!==t.com.jobCategory[e].num&&(t.isActive=e,t.typelist=t.com.jobCategory[e].typelist)},t.$watch("com",function(e){if(e)for(var o=t.com.jobCategory,a=0,r=o.length;a<r;a++)if(o[a].num>0){t.showTypeList(a);break}})}}}]),angular.module("app").directive("appCompanyInfo",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/companyInfo.html",scope:{com:"=",ds:"="}}}]),angular.module("app").directive("appContent",["$filter","$timeout","ajax","dealUtil","cache",function(t,e,o,a,r){return{restrict:"A",replace:!0,templateUrl:"view/template/content.html",link:function(n){r.get("name")?n.goLogin="编辑":n.goLogin="去登陆",n.pagenum=1,n.isLoadShow=!1,n.sortData=function(t){n.listLen=t.length,n.total=Math.ceil(n.listLen/10),n.total<=1?n.isLoadShow=!1:n.isLoadShow=!0,n.newData=a.shuffle(t),n.list=n.newData.slice(0,10*n.pagenum),n.list.sort(function(t,e){return t.companyId-e.companyId})},n.loadHandler=function(){if(n.pagenum++,!(n.pagenum>n.total)&&(n.piece=n.newData.slice(10*(n.pagenum-1),10*n.pagenum),n.piece.sort(function(t,e){return t.companyId-e.companyId}),n.list=n.list.concat(n.piece),n.pagenum==n.total)){var t=angular.element(document.querySelector(".more"));e(function(){t.html("没有更多加载")},600)}},o.getData("data/position.json").then(function(e){n.oldData=e.data.data,n.$watch("filterObj",function(e,o){if(e){if(1==Object.getOwnPropertyNames(e).length&&e.hasOwnProperty("city"))return;n.filter=t("searchFilter")(n.oldData,e),n.sortData(n.filter),n.loadMore=n.loadHandler}else n.sortData(n.oldData),n.loadMore=n.loadHandler},!0)})}}}]),angular.module("app").directive("appFoot",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/foot.html"}}]),angular.module("app").directive("appFootBar",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/footBar.html"}}]),angular.module("app").directive("appHead",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/head.html"}}]),angular.module("app").directive("appHeadBar",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/headBar.html",scope:{text:"=",isShow:"="},link:function(t){t.back=function(){window.history.back()}}}}]),angular.module("app").directive("appMineContent",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/mineContent.html"}}]),angular.module("app").directive("appPosDesc",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/posDesc.html",scope:{desc:"="}}}]),angular.module("app").directive("appPosInfo",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/posInfo.html",scope:{pos:"="}}}]),angular.module("app").directive("appSearchContent",["$filter","localStorageService","dealUtil",function(t,e,o){return{restrict:"A",replace:!0,templateUrl:"view/template/searchContent.html",scope:{city:"="},link:function(a,r,n){a.isShow=!0,a.isCityShow=!1,a.isHistoryShow=!0,a.isJobShow=!1,a.cityName="全国",a.filterObj={},a.history=e.getLocalStorage("history"),a.boolA=["isJobShow","isHistoryShow","isEmpty"],a.attrA=["city","jobName","company"],a.showCityList=function(){a.isCityShow=!0},a.hideCityList=function(){a.isCityShow=!1},a.search=function(){a.val?(a.setAttr(a.filterObj,a.attrA,[a.cityName,a.val,a.val]),a.history.unshift(a.val),a.history=t("uniqueArry")(a.history),a.sEvent()):a.setAttr(a,a.boolA,[!1,!0,!1]),a.history.length>6&&a.history.pop(),e.removeLocalStorage("history"),e.setLocalStorage("history",a.history)},a.getCity=function(t){a.isCityShow=!1,a.cityName=t,a.filterObj.city=t},a.$watch("val",function(t,e){t||(a.setAttr(a,a.boolA,[!1,!0,!1]),a.delAttr(a.filterObj,["jobName","company"]))}),a.hisClick=function(t){a.setAttr(a.filterObj,a.attrA,[a.cityName,t,t]),a.sEvent(),a.val=t},a.sEvent=function(){a.$watch("filter",function(t,e){0!=t.length?a.setAttr(a,a.boolA,[!0,!1,!1]):a.setAttr(a,a.boolA,[!1,!1,!0])})},a.delAttr=function(t,e){for(var o=0;o<e.length;o++)delete t[e[o]]},a.setAttr=function(t,e,o){for(var a=0;a<e.length;a++)t[e[a]]=o[a]},a.delHis=function(t,r){t.stopPropagation(),o.removeItem(a.history,r),e.removeLocalStorage("history"),e.setLocalStorage("history",a.history)}}}}]),angular.module("app").filter("searchFilter",[function(){return function(t,e){var o=[];return angular.forEach(t,function(t){"全国"==e.city?(t.jobName.indexOf(e.jobName)>0||t.company==e.company)&&o.push(t):t.city==e.city&&(t.jobName.indexOf(e.jobName)>0||t.company==e.company)&&o.push(t)}),o}}]),angular.module("app").filter("uniqueArry",[function(){return function(t){for(var e={},o=[],a=t.length-1;a>=0;a--)e[t[a]]||(o.unshift(t[a]),e[t[a]]=1);return o}}]),angular.module("app").service("cache",["$cookies",function(t){this.put=function(e,o){t.put(e,o)},this.get=function(e){return t.get(e)},this.remove=function(e){t.remove(e)}}]),angular.module("app").service("dealUtil",[function(){this.shuffle=function(t){for(var e=t.concat(),o=e.length;o--;){var a=Math.floor(Math.random()*(o+1)),r=e[o];e[o]=e[a],e[a]=r}return e},this.removeItem=function(t,e){for(var o=0;o<t.length;o++)if(t[o]=e){t.splice(o,1);break}return t}}]),angular.module("app").service("ajax",["$http","$q",function(t,e){this.getData=function(o,a){var r=e.defer(),n=r.promise;return t({method:"get",url:o,params:a}).then(function(t){r.resolve(t)}).catch(function(t){r.reject(t)}),n}}]),angular.module("app").service("localStorageService",["$window",function(t){this.setLocalStorage=function(e,o){t.localStorage[e]="object"==typeof o?JSON.stringify(o):o},this.getLocalStorage=function(e){if(t.localStorage[e])return JSON.parse(t.localStorage[e])},this.removeLocalStorage=function(e){t.localStorage.removeItem(e)}}]);